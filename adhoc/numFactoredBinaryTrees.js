const mod = Math.pow(10, 9) + 7;

/**
 * @param {number[]} arr
 * @return {number}
 */
var numFactoredBinaryTrees = function (arr) {
  const dp = new Map();
  arr.sort((a, b) => a - b);
  const max = arr[arr.length - 1];
  for (let i = 0; i < arr.length; i++) {
    dp.set(arr[i], 1);
  }
  let result = 0;
  for (let i = 0; i < arr.length; i++) {
    for (let j = 0; j <= i; j++) {
      const a = arr[i];
      const b = arr[j];
      const c = a * b;
      if (c > max) {
        break;
      }
      const m = dp.get(c);
      if (m) {
        dp.set(
          c,
          m + (a === b ? dp.get(a) * dp.get(b) : dp.get(a) * dp.get(b) * 2)
        );
      }
    }
    result += dp.get(arr[i]);
  }
  return result % mod;
};

// 1000000000
// 933644026338024200

// 3,7,12,777, 509730797
console.log(numFactoredBinaryTrees([2, 4]));
console.log(numFactoredBinaryTrees([2, 4, 5, 10]));
console.log(numFactoredBinaryTrees([18, 3, 6, 2]));
console.log(
  numFactoredBinaryTrees([
    45, 42, 2, 18, 23, 1170, 12, 41, 40, 9, 47, 24, 33, 28, 10, 32, 29, 17, 46,
    11, 759, 37, 6, 26, 21, 49, 31, 14, 19, 8, 13, 7, 27, 22, 3, 36, 34, 38, 39,
    30, 43, 15, 4, 16, 35, 25, 20, 44, 5, 48,
  ])
);
// prettier-ignore
console.log(numFactoredBinaryTrees([46,144,5040,4488,544,380,4410,34,11,5,3063808,5550,34496,12,540,28,18,13,2,1056,32710656,31,91872,23,26,240,18720,33,49,4,38,37,1457,3,799,557568,32,1400,47,10,20774,1296,9,21,92928,8704,29,2162,22,1883700,49588,1078,36,44,352,546,19,523370496,476,24,6000,42,30,8,16262400,61600,41,24150,1968,7056,7,35,16,87,20,2730,11616,10912,690,150,25,6,14,1689120,43,3128,27,197472,45,15,585,21645,39,40,2205,17,48,136]));
// prettier-ignore
console.log(numFactoredBinaryTrees([277175715,645202070,364632537,989641912,828726955,516494729,744368921,787673501,565349276,66362806,569924966,992821705,122920640,109930324,835922180,520204529,835084297,236498012,928248777,141110751,489261337,649156648,436578721,910801047,773574661,518559104,795556604,298295858,566409758,414558765,252901034,671475249,575646220,741223205,928095754,510826559,887250629,309285712,262726698,583185947,944200547,361273025,347143430,711037876,901756858,876533036,401578972,469285200,613003678,567205063,864446653,766144361,999084821,608567724,343829933,231868180,357142488,656000024,237356328,92565745,361494546,260481036,682440284,171822263,33077720,948703316,696488817,728466589,509731246,825634565,151114491,403117346,571434854,607418837,679569068,197169383,351185558,907367299,622611356,589019084,45799396,89709896,83215058,503426624,8365368,956759174,234401323,235198746,690163075,570111871,988501540,189310016,953906949,811004260,254259160,167530127,827678587,184445459,570098221,67682587,614451652,898798505,304380490,492503762,707094947,73340284,920013951,360441281,613354450,43757272,564540965,367111634,165073831,841678358,266297393,718736228,83209123,460661050,347699330,516825761,114617039,792371739,717055186,912281720,752602462,584146035,512604300,348214514,637393422,617410916,613512645,116593793,118365485,716474963,15158299,518429649,360208903,252402771,79001902,811481106,554493548,378546164,861472182,725617813,298734924,917496962,400471114,211769619,754110450,671480369,526023032,963811156,834476875,594080945,519524599,243890537,755770534,513807837,166280763,210308243,753326440,39078868,991125311,487851164,360295778,541237452,846997985,154397235,730999939,455808341,34916455,529706386,371476236,520557288,594869694,81289829,73280673,434755857,121940467,867320973,198342674,649198480,705456495,929422329,167216453,154126563,378166783,909092672,414445172,373734485,225653324,338482580,471861963,405183160,894697885,948412087,277889875,378761695,167579397,598204636,981960810,554530174,17604289,751354813,344122557,560600534,515691347,325048834,888643661,10803273,642799919,550531009,193903787,948351310,940955846,394398261,445655732,388279110,102081585,939864945,418401556,998746596,293329937,145388523,431956499,673015184,775204641,901160221,911790557,940184273,208407398,803283409,861220895,132619735,211057147,435522876,830910180,485677380,287640886,618196005,730926723,120324880,975112154,232982323,601605873,152906533,642364982,888424983,566598920,13313656,664406132,671322758,667442643,30905309,766150142,220133474,885841616,679921351,253924085,872137052,947150175,824466351,409627566,604896674,269129684,811915820,349432521,486699205,492407657,739762626,13706702,323824148,888236788,365167912,176227434,806512147,405441815,741822623,140684485,400598955,525127675,806585174,636775981,8660655,474414188,906749397,573598822,849463007,604708531,396893916,868055685,775939575,774893615,631835248,953960030,718440370,868083009,281535368,440797455,135118915,851443387,268625954,626134542,838457038,502295824,904492720,16957281,296591012,486504084,332930135,680467725,567631364,913563099,346241212,419824836,623814442,432096253,166002102,741319754,687562955,624928708,202449202,606047867,726687190,933533473,183549945,34689390,559510190,294119579,921664913,839651177,448676502,950530672,261205560,236134283,834435116,722093036,67873812,101045912,916626662,213643486,344348505,134060088,288614510,410945011,691415883,608883383,623530769,759338111,664150714,779387779,901668099,143769465,667614736,222667159,197850671,435453310,958237638,641685586,27472482,864168509,89350753,436729898,300074951,667587564,944402412,427220826,218427294,1327754,553949051,19753043,250029580,284610098,961993817,206893989,182239044,211635057,195713702,532660903,456606473,301435037,226573604,222757599,695800483,972616082,362615751,611650262,75812005,368633882,389718394,344459078,942736641,798952966,361028552,947487627,589692530,2838086,285401227,637904441,733913350,162419548,683429791,829682808,447137181,978367683,283202690,578838186,605737356,591211483,569320785,586137801,804149725,664333774,146249644,253241142,355385804,964323049,595852969,911668511,137058035,715183746,59487219,83737772,277933440,166564273,644069307,623671394,299037128,885572724,712266264,156135124,359566651,978969920,78499080,470776816,719074486,916351348,753209926,723213011,8435261,980498567,380466185,935905192,721689984,170248512,160768456,231304887,643561292,328678264,511383233,475162800,34644875,695735971,574160186,644586367,578334624,344396755,714571112,76253313,929232798,997226705,813782851,513225900,197501811,570706425,500183988,618606158,736260308,102522822,36469719,299560592,423911440,972788574,829986549,303634084,569748322,905123866,436856329,39086681,135792458,792107556,333824922,842613566,576514620,123892611,265503587,524590982,69275403,173188614,784883058,527470357,714886172,411280532,183864705,410540739,957194274,571109513,21607876,938944360,773654033,355627408,526474049,521222401,331190878,52612191,461634994,225974348,52081425,781201466,950680306,77057075,829303028,886921747,129171660,980754891,979743883,164509875,234425633,188773795,90668852,76726925,328952673,977785665,432910206,744013967,543395817,521054780,49362843,619253271,25770173,156609918,351561872,977937336,417869406,722154516,877490941,629282132,304702114,496347475,393887738,639859757,844430292,264088711,531928383,589697576,35747046,923226305,376187752,522431843,926380344,949517035,67282298,910114873,604483224,888165508,861181016,894925005,276553687,169981929,808831093,715403263,97764536,366792405,148401696,941550070,756819067,109961267,341646584,754608275,225890715,412850283,173307274,635929236,153676640,36082505,48058509,18109964,376431776,871826241,108243316,846355486,914570580,556530516,159166747,795605862,910823740,507580856,137937769,832058698,446434042,262232722,502471844,643731966,888999144,663439502,894120445,328533147,661813194,174422816,450818266,745517971,632111403,718670013,53488636,263082467,342963918,877352517,396220269,997583980,837672364,32875168,339608727,82864807,257917421,966264232,118567826,838297,897728092,796920533,786165025,607251970,481423369,356327786,771925143,832054191,578893052,222121584,82321099,474364752,586537922,584521103,435546838,511364930,339375041,580938383,765143750,464363311,548929015,780418460,175303067,18633352,99765597,797585420,357929488,246561694,820106728,526272370,644020146,952919041,351790208,654034467,980363997,962989721,378820231,344801071,662646506,697532621,402966867,609748224,355413558,838237902,7211260,422933955,573091756,742546758,444056630,779727840,64931068,909678912,710942539,840681037,820758326,168464032,472083779,14832511,580458405,22510446,662851796,535454204,79699304,11668403,793921408,882050473,37382996,640074009,526400448,351601557,528482509,377696833,228654326,73288137,620981853,941512899,83819421,645182437,938552729,676033284,831342562,105799236,632349562,626209098,520950008,430804676,659810686,925685369,515012126,709374966,714488893,884278347,561367332,726742135,148141778,653335839,606692007,554674478,835427604,332725045,545189107,905677818,286082771,635249124,782952287,104828280,167605384,502500267,578453626,20187484,748995880,506001559,437164976,598420284,403948116,369514237,470279153,984253780,432882272,44068797,334482160,914568018,456172283,554620845,29700973,399998616,746398960,628741213,987583913,459540303,590102724,157082912,810014140,565053765,491574480,837589207,631776844,860957509,913489825,475067028,375870370,281300881,376330117,67682436,381564191,413254577,42428584,754176951,370060002,622410107,483943547,147513811,607831311,200308118,91098725,381634800,744679270,924259680,925857531,538920949,880446905,746563995,923567926,358873278,711688776,661603127,9513214,967803036,1283983,501490046,390028966,522998045,386168077,399477590,302046965,8860865,230188138,152203631,536304560,174041347,396410471,741122702,732982587,416425121,498530743,586836933,777159823,796671581,895821093,144310878,946806285,803223216,475941610,523380038,889583930,509481706,521049032,609576556,437643835,595966729,833134499,885769548,653253281,525170156,434417043,911306075,645242588,376283568,741235651,362467983,904878610,693748556,763813351,504252828,428683797,718007098,883410088,773836047,526468838,17783175,272874751,251755092,980504038,392242680,747729675,331306210,476563176,68444018,9967213,249408089,450359157,811158096,861238126,941793398,376277094,715077647,317675157,77937106,604988944,649536231,894068622,457851953,282388742,832932326,61791080,437970820,591568668,710677181,691575869,692465985,839026800,998177996,449946898,108472878,585173385,997305296,565568592,461874572,429139043,535692218,517041022,389904517,813012906,563785093,211615051,816344794,199013964,405481770,527006118,449848653,199675318,906924957,433428953,107637958,444033788,365041815,646719331,309645690,184898752,408794686,298633657,978190234,992637103,323150325,804100446,319567860,893926696,526070444,957726158,846873545,442352342,736579230,842022592,801934907,699089932,309388516,36382907,365274794,187636444,34776105,86101036,962933221,498863810,877495995,685098208,632324649,128152463,866495241,232335752,4557072,660105624,777797140,684709078,709864141,171419181,799108088,300200856,808997306,586573065,441002205,679858729,538553087,787537626,976208665,447544017,64617769,958043957,577059550,923798469,531857052,805178338,508631533,287575619,226264211,115801442,679319866,643883590,950592754,833971266,820583092,405196429,634297097,111185557,200171804,563461734,545736076,689190873,131695582,357152244,235319442,685101024,681330702,769624500,923164068,283707156,397643520,88911325,288386638,825963922,828277947,197833549,543803880,135519431,70625116,719306090,904011526,258402863,914849220,431739659,353602410,994742483,870361812,768937324,935333864,927572969,869204616,977762425,749941379,573258055,645631624,208802226,94109095,439392875]));
